<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Triage Dashboard v10.0</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <div id="toast-container"></div>
    
    <div id="modal-overlay" class="hidden">
        <div id="modal-box">
            <h3 id="modal-title">Alert</h3>
            <p id="modal-message">Message</p>
            <div id="modal-actions">
                <button id="modal-close">Acknowledge</button>
            </div>
        </div>
    </div>

    <div class="container">
        <header>
             <div id="logo-container">
                <div style="font-weight:900; font-size:24px; color:var(--primary); margin-right:15px;">WMEBEM</div>
                <div>
                    <h1>Advanced Triage Dashboard</h1>
                    <span class="version-tag">v10.0 | Safe-Triage Build</span>
                </div>
            </div>
            <div class="header-controls">
                <div class="theme-switch-wrapper">
                    <label class="theme-switch" for="checkbox-theme">
                        <input type="checkbox" id="checkbox-theme" />
                        <div class="slider"></div>
                    </label>
                    <span class="theme-label">Dark Mode</span>
                </div>
                <button id="btn-reset" class="btn-secondary">New Patient</button>
            </div>
        </header>

        <div class="dashboard">

            <div class="card" id="card-demographics">
                <h2>1. Patient Demographics</h2>
                <div class="form-grid">
                    <div class="form-group"><label>Patient ID / Name</label><input type="text" id="patient-id" data-js="patient-id" placeholder="Scan or Type..."></div>
                    <div class="form-group"><label>Date of Birth</label><input type="date" id="patient-dob" data-js="patient-dob"></div>
                </div>
                <div class="info-row">
                    <span id="calculated-age-display" class="highlight-text">Age: --</span>
                </div>
                <div class="form-grid">
                    <div class="form-group"><label>Weight (kg)</label><input type="number" id="patient-weight" data-js="patient-weight" placeholder="Req. for Paeds"></div>
                    <div class="form-group"><label>Sex</label><select id="patient-sex" data-js="patient-sex"><option value="">Select...</option><option value="Male">Male</option><option value="Female">Female</option></select></div>
                </div>
                
                <div class="form-group mt-10">
                    <label>Mobility (for Streaming)</label>
                    <select id="patient-mobility" data-js="patient-mobility">
                        <option value="Walking">Walking</option>
                        <option value="Wheelchair">Wheelchair</option>
                        <option value="Trolley">Trolley / Bed Bound</option>
                    </select>
                </div>

                <div id="female-health-section" class="hidden alert-section">
                    <div class="form-group checkbox-group">
                        <input type="checkbox" id="check-pregnant" data-js="check-pregnant">
                        <label>Pregnant / Postpartum (&lt;6w)</label>
                    </div>
                    <div class="form-group">
                        <label>LMP (Last Menstrual Period)</label>
                        <input type="date" id="date-lmp" data-js="date-lmp">
                    </div>
                </div>
            </div>

            <div class="card span-2" id="card-obs">
                <h2 id="obs-title">2. Physiology</h2>
                
                <div id="obs-form" class="obs-grid">
                    <div class="obs-item">
                        <label>Resp Rate</label>
                        <input type="number" id="obs-rr" data-js="obs-rr" placeholder="--">
                    </div>
                    <div class="obs-item">
                        <label>SpO₂ (%)</label>
                        <input type="number" id="obs-sats" data-js="obs-sats" placeholder="--">
                    </div>
                    
                    <div class="obs-item span-2-mobile">
                        <label>Oxygen</label>
                        <div class="segmented-control" id="seg-o2">
                            <button data-value="Air" class="active">Air</button>
                            <button data-value="O2">O₂</button>
                        </div>
                    </div>

                    <div class="obs-item">
                        <label>Systolic BP</label>
                        <input type="number" id="obs-sbp" data-js="obs-sbp" placeholder="--">
                    </div>
                    <div class="obs-item">
                        <label>Heart Rate</label>
                        <input type="number" id="obs-hr" data-js="obs-hr" placeholder="--">
                    </div>
                    
                    <div class="obs-item span-2-mobile">
                        <label>AVPU</label>
                        <div class="segmented-control" id="seg-avpu">
                            <button data-value="A" class="active">A</button>
                            <button data-value="V">V</button>
                            <button data-value="P">P</button>
                            <button data-value="U">U</button>
                        </div>
                    </div>

                    <div class="obs-item">
                        <label>Temp (°C)</label>
                        <input type="number" id="obs-temp" data-js="obs-temp" step="0.1" placeholder="--">
                    </div>
                    <div class="obs-item full-width-checkbox">
                        <input type="checkbox" id="obs-scale2" data-js="obs-scale2">
                        <label for="obs-scale2">Use Scale 2 (CO₂ Retainer)</label>
                    </div>
                </div>

                <div id="visual-ews-container" class="mt-15"></div>
            </div>
            
            <div class="card span-2">
                <h2>3. History & Complaint</h2>
                <div class="quick-actions-bar">
                    <span class="label-small">Quick Complaints:</span>
                    <button class="btn-chip" data-action="setComplaint" data-val="Chest Pain">Chest Pain</button>
                    <button class="btn-chip" data-action="setComplaint" data-val="Abdominal Pain">Abdo Pain</button>
                    <button class="btn-chip" data-action="setComplaint" data-val="Shortness of Breath">SOB</button>
                    <button class="btn-chip" data-action="setComplaint" data-val="Fall">Fall</button>
                    <button class="btn-chip" data-action="setComplaint" data-val="Head Injury">Head Injury</button>
                </div>

                <div class="form-group mt-10">
                    <label>Presenting Complaint (Search)</label>
                    <input list="flowcharts" id="input-complaint" data-js="input-complaint" placeholder="Start typing (e.g. Chest Pain)...">
                    <datalist id="flowcharts"></datalist>
                </div>

                <div class="split-view">
                    <div class="history-inputs">
                        <div class="form-group">
                            <label>Allergies <button class="btn-tiny" data-action="quickText" data-target="allergies" data-val="NKDA">NKDA</button></label>
                            <textarea id="allergies" data-js="allergies" rows="1"></textarea>
                        </div>
                        <div class="form-group">
                            <label>PMH <button class="btn-tiny" data-action="quickText" data-target="pmh" data-val="Nil known">Nil</button></label>
                            <textarea id="pmh" data-js="pmh" rows="2"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Meds <button class="btn-tiny" data-action="quickText" data-target="meds" data-val="Nil known">Nil</button></label>
                            <textarea id="meds" data-js="meds" rows="2"></textarea>
                        </div>
                    </div>

                    <div class="discriminator-panel">
                        <label>Triage Discriminator (Select First Applicable)</label>
                        <div id="discriminator-container" class="scroll-box">
                            <p class="placeholder-text">Select a complaint above to view flowcharts.</p>
                        </div>
                    </div>
                </div>

                <div class="pain-section mt-15">
                    <label>Pain Score: <span id="pain-val">0</span>/10</label>
                    <div class="pain-btn-group" id="pain-btn-container">
                        </div>
                </div>
            </div>

            <div class="card" id="card-screening">
                <h2>4. Screening</h2>
                <div id="screening-container"></div>
            </div>

            <div class="card span-2" id="card-plan">
                <h2>5. Triage Decision & Plan</h2>
                <div class="plan-grid">
                    <div class="priority-box">
                        <div id="priority-display" class="priority-badge priority-Blue">WAITING</div>
                        
                        <div class="stream-badge" id="stream-display">Stream: Pending</div>
                        <div class="timer-badge" id="timer-display">Retriage: --</div>

                        <div id="priority-reasons"></div>
                        
                        <div class="override-section">
                            <label><input type="checkbox" id="check-override" data-js="check-override"> Clinical Override</label>
                            <div id="override-options" class="hidden">
                                <select id="sel-override" data-js="sel-override">
                                    <option value="Red">Red</option><option value="Orange">Orange</option><option value="Yellow">Yellow</option><option value="Green">Green</option>
                                </select>
                                <input type="text" id="txt-override" data-js="txt-override" placeholder="Reason (Mandatory)">
                            </div>
                        </div>
                    </div>
                    
                    <div class="protocol-box">
                        <h3>Clinical Protocol</h3>
                        <div id="protocol-actions">
                             <p class="placeholder-text">Select a complaint to view protocol.</p>
                        </div>
                        <div id="sepsis-actions" class="hidden warning-box mt-10">
                            <strong>SEPSIS 6 TRIGGERED:</strong>
                            <ul>
                                <li>Give Oxygen (target 94-98%)</li>
                                <li>Take Blood Cultures</li>
                                <li>Give IV Antibiotics</li>
                                <li>Give Fluid Challenge</li>
                                <li>Measure Lactate & Hb</li>
                                <li>Measure Urine Output</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card full-width">
                <h2>6. EPR Note</h2>
                <textarea id="epr-note" rows="6" readonly class="code-font"></textarea>
                <div class="note-controls">
                    <button id="btn-copy">Copy to Clipboard</button>
                </div>
            </div>
            
            <div id="paeds-panel" class="card" style="display:none; border-color:var(--orange);">
                <h3>Paediatric Safety</h3>
                <div id="paeds-content"></div>
                <div id="pews-content" class="mt-10"></div>
            </div>

        </div>
        
        <footer>
            <p>v10.0 | Educational Use Only | Adhere to local Trust Guidelines</p>
        </footer>
    </div>
    
    <script type="module" src="app.js"></script>
</body>
</html>
