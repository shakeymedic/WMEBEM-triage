<!DOCTYPE html>
<html lang="en-GB">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WMEBEM Triage Dashboard v12.0</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <div id="toast-container"></div>
    
    <div id="modal-overlay" class="hidden" aria-hidden="true">
        <div id="modal-box" role="dialog" aria-modal="true">
            <h3 id="modal-title">Clinical Alert</h3>
            <p id="modal-message">Message</p>
            <div id="modal-actions">
                <button id="modal-close" class="btn-primary">Acknowledge</button>
            </div>
        </div>
    </div>

    <div class="container">
        <header>
             <div id="logo-container">
                <div class="logo-text">WMEBEM</div>
                <div>
                    <h1>Advanced Triage Dashboard</h1>
                    <span class="version-tag">v12.0 | Consultant Approved</span>
                </div>
            </div>
            <div class="header-controls">
                <button id="btn-history" class="btn-secondary" title="View Recent Patients">ðŸ•’ History</button>
                <div class="theme-switch-wrapper" title="Toggle Dark Mode">
                    <label class="theme-switch" for="checkbox-theme">
                        <input type="checkbox" id="checkbox-theme" />
                        <div class="slider"></div>
                    </label>
                </div>
                <button id="btn-reset" class="btn-warning">New Patient</button>
            </div>
        </header>

        <main class="dashboard">

            <section class="card" id="card-demographics">
                <h2>1. Patient ID & Demographics</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="patient-id">Patient ID / Name</label>
                        <input type="text" id="patient-id" data-js="patient-id" placeholder="Scan or Type..." autocomplete="off">
                    </div>
                    <div class="form-group">
                        <label for="patient-dob">Date of Birth</label>
                        <input type="date" id="patient-dob" data-js="patient-dob">
                    </div>
                </div>
                <div class="info-row">
                    <span id="calculated-age-display" class="highlight-text">Age: --</span>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="patient-weight">Weight (kg) <small class="text-muted">(Req. for Paeds)</small></label>
                        <input type="number" id="patient-weight" data-js="patient-weight" placeholder="kg">
                    </div>
                    <div class="form-group">
                        <label for="patient-sex">Sex</label>
                        <select id="patient-sex" data-js="patient-sex">
                            <option value="">Select...</option>
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group mt-10">
                    <label for="patient-mobility">Mobility (Streaming)</label>
                    <select id="patient-mobility" data-js="patient-mobility">
                        <option value="Walking">Walking / Self-Caring</option>
                        <option value="Wheelchair">Wheelchair</option>
                        <option value="Trolley">Trolley / Bed Bound</option>
                    </select>
                </div>

                <div id="female-health-section" class="hidden alert-section">
                    <div class="form-group checkbox-group">
                        <input type="checkbox" id="check-pregnant" data-js="check-pregnant">
                        <label for="check-pregnant">Pregnant / Postpartum (< 6w)</label>
                    </div>
                    <div class="form-group">
                        <label for="date-lmp">LMP (Last Menstrual Period)</label>
                        <input type="date" id="date-lmp" data-js="date-lmp">
                    </div>
                </div>
            </section>

            <section class="card span-2" id="card-obs">
                <h2 id="obs-title">2. Physiology (NEWS2)</h2>
                
                <div id="obs-form" class="obs-grid">
                    <div class="obs-item">
                        <label for="obs-rr">Resp Rate</label>
                        <input type="number" id="obs-rr" data-js="obs-rr" placeholder="RR">
                    </div>
                    <div class="obs-item">
                        <label for="obs-sats">SpOâ‚‚ (%)</label>
                        <input type="number" id="obs-sats" data-js="obs-sats" placeholder="%">
                    </div>
                    
                    <div class="obs-item span-2-mobile">
                        <label>Oxygen Delivery</label>
                        <div class="segmented-control" id="seg-o2">
                            <button data-value="Air" class="active" type="button">Air</button>
                            <button data-value="O2" type="button">Oâ‚‚</button>
                        </div>
                    </div>

                    <div class="obs-item">
                        <label for="obs-sbp">Systolic BP</label>
                        <input type="number" id="obs-sbp" data-js="obs-sbp" placeholder="mmHg">
                    </div>
                    <div class="obs-item">
                        <label for="obs-hr">Heart Rate</label>
                        <input type="number" id="obs-hr" data-js="obs-hr" placeholder="BPM">
                    </div>
                    
                    <div class="obs-item span-2-mobile">
                        <label>AVPU / GCS</label>
                        <div class="segmented-control" id="seg-avpu">
                            <button data-value="A" class="active" type="button">A</button>
                            <button data-value="V" type="button">V</button>
                            <button data-value="P" type="button">P</button>
                            <button data-value="U" type="button">U</button>
                        </div>
                    </div>

                    <div class="obs-item">
                        <label for="obs-temp">Temp (Â°C)</label>
                        <input type="number" id="obs-temp" data-js="obs-temp" step="0.1" placeholder="Â°C">
                    </div>
                    <div class="obs-item full-width-checkbox">
                        <input type="checkbox" id="obs-scale2" data-js="obs-scale2">
                        <label for="obs-scale2">Scale 2 (COâ‚‚ Retainer)</label>
                    </div>
                </div>

                <div id="visual-ews-container" class="mt-15">
                    </div>
            </section>
            
            <section class="card span-2">
                <h2>3. History & Complaint</h2>
                <div class="quick-actions-bar">
                    <span class="label-small">Common:</span>
                    <button class="btn-chip" data-action="setComplaint" data-val="Chest Pain">Chest Pain</button>
                    <button class="btn-chip" data-action="setComplaint" data-val="Abdominal Pain">Abdo Pain</button>
                    <button class="btn-chip" data-action="setComplaint" data-val="Shortness of Breath">SOB</button>
                    <button class="btn-chip" data-action="setComplaint" data-val="Fall">Fall</button>
                    <button class="btn-chip" data-action="setComplaint" data-val="Head Injury">Head Injury</button>
                </div>

                <div class="form-group mt-10">
                    <label>
                        Presenting Complaint 
                        <button class="mic-btn" data-target="input-complaint" title="Dictate Complaint">ðŸŽ¤</button>
                    </label>
                    <input list="flowcharts" id="input-complaint" data-js="input-complaint" placeholder="Type or Dictate..." autocomplete="off">
                    <datalist id="flowcharts"></datalist>
                </div>

                <div class="split-view">
                    <div class="history-inputs">
                        <div class="form-group">
                            <label>Allergies <button class="btn-tiny" data-action="quickText" data-target="allergies" data-val="NKDA">NKDA</button> <button class="mic-btn" data-target="allergies">ðŸŽ¤</button></label>
                            <textarea id="allergies" data-js="allergies" rows="1"></textarea>
                        </div>
                        <div class="form-group">
                            <label>PMH <button class="btn-tiny" data-action="quickText" data-target="pmh" data-val="Nil known">Nil</button> <button class="mic-btn" data-target="pmh">ðŸŽ¤</button></label>
                            <textarea id="pmh" data-js="pmh" rows="2"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Meds <button class="btn-tiny" data-action="quickText" data-target="meds" data-val="Nil known">Nil</button> <button class="mic-btn" data-target="meds">ðŸŽ¤</button></label>
                            <textarea id="meds" data-js="meds" rows="2"></textarea>
                        </div>
                    </div>

                    <div class="discriminator-panel">
                        <label>Triage Discriminator</label>
                        <div id="discriminator-container" class="scroll-box">
                            <p class="placeholder-text">Select a complaint above to view flowcharts.</p>
                        </div>
                    </div>
                </div>

                <div class="pain-section mt-15">
                    <label>Pain Score: <span id="pain-val">0</span>/10</label>
                    <div class="pain-btn-group" id="pain-btn-container">
                        </div>
                </div>
            </section>

            <section class="card" id="card-screening">
                <h2>4. Mandatory Screening</h2>
                <div id="screening-container"></div>
            </section>

            <section class="card span-2" id="card-plan">
                <h2>5. Decision & Plan</h2>
                <div class="plan-grid">
                    <div class="priority-box">
                        <div id="priority-display" class="priority-badge priority-Blue">WAITING</div>
                        
                        <div class="stream-badge" id="stream-display">Stream: Pending</div>
                        <div class="timer-badge" id="timer-display">Retriage: --</div>

                        <div id="priority-reasons"></div>
                        
                        <div class="override-section">
                            <label><input type="checkbox" id="check-override" data-js="check-override"> Clinical Override</label>
                            <div id="override-options" class="hidden">
                                <select id="sel-override" data-js="sel-override">
                                    <option value="Red">Red (Immediate)</option>
                                    <option value="Orange">Orange (15m)</option>
                                    <option value="Yellow">Yellow (60m)</option>
                                    <option value="Green">Green (120m)</option>
                                </select>
                                <input type="text" id="txt-override" data-js="txt-override" placeholder="Reason (Mandatory)">
                            </div>
                        </div>
                    </div>
                    
                    <div class="protocol-box">
                        <h3>Clinical Protocol</h3>
                        <div id="protocol-actions">
                             <p class="placeholder-text">Select a complaint to view protocol.</p>
                        </div>
                        <div id="sepsis-actions" class="hidden warning-box mt-10">
                            <strong>âš¡ SEPSIS 6 TRIGGERED:</strong>
                            <ul>
                                <li>Give Oxygen (target 94-98%)</li>
                                <li>Take Blood Cultures</li>
                                <li>Give IV Antibiotics</li>
                                <li>Give Fluid Challenge</li>
                                <li>Measure Lactate & Hb</li>
                                <li>Measure Urine Output</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </section>

            <section class="card full-width">
                <h2>6. EPR Note</h2>
                <textarea id="epr-note" rows="8" readonly class="code-font"></textarea>
                <div class="note-controls">
                    <button id="btn-copy" class="btn-primary">Copy to Clipboard</button>
                </div>
            </section>
            
            <div id="paeds-panel" class="card full-width" style="display:none; border-color:var(--orange);">
                <h3>Paediatric Safety</h3>
                <div class="split-view">
                    <div id="paeds-content"></div>
                    <div id="pews-content"></div>
                </div>
            </div>

        </main>
        
        <aside id="history-sidebar">
            <h3>Recent Patients</h3>
            <div id="history-list"></div>
            <button id="btn-close-history" class="btn-secondary" style="margin-top:20px; width:100%;">Close</button>
        </aside>
        
        <footer>
            <p>v12.0 | Educational Use Only | Adhere to local Trust Guidelines | <a href="#" onclick="localStorage.clear();location.reload()">Clear Cache</a></p>
        </footer>
    </div>
    
    <script type="module" src="app.js"></script>
</body>
</html>
