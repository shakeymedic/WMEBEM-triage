<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Triage Dashboard v8.0</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <div id="toast-container"></div>

    <div class="container">
        <header>
             <div id="logo-container">
                <img id="logo" src="https://iili.io/KGQOvkl.md.png" alt="WMEBEM Logo">
                <h1>Advanced Triage Dashboard</h1>
            </div>
            <div style="display:flex; align-items:center;">
                <div class="theme-switch-wrapper">
                    <label class="theme-switch" for="checkbox-theme">
                        <input type="checkbox" id="checkbox-theme" />
                        <div class="slider"></div>
                    </label>
                    <span style="font-size:0.8em; margin-left:5px;">Dark Mode</span>
                </div>
                <button id="btn-reset">Start New Patient</button>
            </div>
        </header>

        <div class="dashboard">

            <div class="card">
                <h2>Patient Demographics</h2>
                <div class="form-group"><label>Patient Name / ID</label><input type="text" id="patient-id" placeholder="ID or Name"></div>
                <div class="form-group"><label>Date of Birth</label><input type="date" id="patient-dob"></div>
                <div class="form-group"><label>Calculated Age: <span id="calculated-age-display">--</span></label></div>
                <div class="form-grid">
                    <div class="form-group"><label>Weight (kg)</label><input type="number" id="patient-weight"></div>
                    <div class="form-group"><label>Sex</label><select id="patient-sex"><option value="">Select</option><option value="Male">Male</option><option value="Female">Female</option></select></div>
                </div>
                <div class="form-group checkbox-group" id="pregnancy-container" style="display: none;">
                    <input type="checkbox" id="patient-pregnant"><label>Pregnant / <6w Postpartum</label>
                </div>
            </div>
            
            <div class="card">
                <h2>Clinical History</h2>
                <div class="form-group"><div class="label-with-checkbox"><label>Allergies</label><button class="quick-btn" onclick="setQuickText('allergies', 'NKDA')">NKDA</button></div><textarea id="allergies" rows="2"></textarea></div>
                <div class="form-group"><div class="label-with-checkbox"><label>PMH</label><button class="quick-btn" onclick="setQuickText('pmh', 'Nil known')">Nil</button></div><textarea id="pmh" rows="2"></textarea></div>
                <div class="form-group"><div class="label-with-checkbox"><label>Meds</label><button class="quick-btn" onclick="setQuickText('meds', 'Nil known')">Nil</button></div><textarea id="meds" rows="2"></textarea></div>
            </div>

            <div class="card span-2">
                <h2>Presenting Complaint</h2>
                <div class="dashboard">
                    <div id="complaint-section">
                        <div class="form-group">
                            <label>Primary Complaint (Search):</label>
                            <input list="flowcharts" id="mts-flowchart-input" placeholder="Start typing (e.g., Chest Pain)...">
                            <datalist id="flowcharts"></datalist>
                        </div>
                        
                        <div class="form-group">
                            <label>Pain Score: <span id="pain-score-val" class="pain-value">0</span>/10</label>
                            <div class="pain-slider-container">
                                <span>0</span><input type="range" id="pain-score" min="0" max="10" value="0"><span>10</span>
                            </div>
                        </div>
                    </div>
                    <div id="discriminator-section">
                        <label>Select Discriminator:</label>
                        <div id="discriminators-container">
                            <p style="opacity:0.6;">Select a complaint to view options.</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card full-width" id="screening-card">
                <h2>Opportunistic Screening</h2>
                <div class="dashboard">
                    
                    <div class="screen-box" id="hiv-screen">
                        <div class="screen-header">
                            <strong>HIV Opt-Out (RCEM/NICE)</strong>
                            <span class="badge-blue">Routine</span>
                        </div>
                        <div class="screen-content">
                            <div class="form-group checkbox-group">
                                <input type="checkbox" id="hiv-test-agreed" checked disabled>
                                <label><strong>Test Indicated (Opt-Out Policy)</strong></label>
                            </div>
                            <button id="btn-hiv-optout" class="small-btn">Patient Opted Out</button>
                            <div id="hiv-optout-reason" style="display:none; margin-top:5px;">
                                <select id="hiv-reason-select">
                                    <option value="Declined">Patient Declined</option>
                                    <option value="Known Positive">Known Positive</option>
                                    <option value="Terminal">Terminal Illness</option>
                                    <option value="Incapable">Lacks Capacity (Best Interests)</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="screen-box" id="alcohol-screen" style="display:none;">
                        <div class="screen-header">
                            <strong>AUDIT-C Alcohol Screen</strong>
                            <span class="badge-orange">Smart Trigger</span>
                        </div>
                        <div class="screen-content">
                            <div class="audit-q"><label>1. How often do you have a drink?</label><select id="audit-1"><option value="0">Never</option><option value="1">Monthly or less</option><option value="2">2-4/month</option><option value="3">2-3/week</option><option value="4">4+/week</option></select></div>
                            <div class="audit-q"><label>2. Units per typical drinking day?</label><select id="audit-2"><option value="0">1-2</option><option value="1">3-4</option><option value="2">5-6</option><option value="3">7-9</option><option value="4">10+</option></select></div>
                            <div class="audit-q"><label>3. Binge (6+ F, 8+ M) frequency?</label><select id="audit-3"><option value="0">Never</option><option value="1">< Monthly</option><option value="2">Monthly</option><option value="3">Weekly</option><option value="4">Daily</option></select></div>
                            <div id="audit-result" style="margin-top:5px; font-weight:bold;">Score: 0</div>
                        </div>
                    </div>

                    <div class="screen-box" id="frailty-screen" style="display:none;">
                        <div class="screen-header">
                            <strong>Frailty & Falls (Silver Book II)</strong>
                            <span class="badge-purple">Age â‰¥65</span>
                        </div>
                        <div class="screen-content">
                             <div class="form-group">
                                <label>Clinical Frailty Scale (CFS)</label>
                                <select id="cfs-score">
                                    <option value="">-- Select --</option>
                                    <option value="1">1. Very Fit</option>
                                    <option value="3">3. Managing Well</option>
                                    <option value="5">5. Mildly Frail</option>
                                    <option value="7">7. Severely Frail</option>
                                    <option value="9">9. Terminally Ill</option>
                                </select>
                            </div>
                            <div class="form-group checkbox-group">
                                <input type="checkbox" id="history-falls">
                                <label>History of Falls?</label>
                            </div>
                        </div>
                    </div>

                    <div class="screen-box" id="istv-screen" style="display:none;">
                        <div class="screen-header">
                            <strong>ISTV (Violence Data)</strong>
                            <span class="badge-red">Assault</span>
                        </div>
                        <div class="screen-content">
                            <div class="form-group"><label>Location of Assault</label><input type="text" id="istv-location" placeholder="e.g. High Street, Pub Name"></div>
                            <div class="form-group"><label>Time of Assault</label><input type="time" id="istv-time"></div>
                            <div class="form-group"><label>Weapon Used?</label><select id="istv-weapon"><option value="None">None / Body Part</option><option value="Knife">Knife / Sharp</option><option value="Glass">Glass / Bottle</option><option value="Blunt">Blunt Object</option><option value="Firearm">Firearm</option></select></div>
                        </div>
                    </div>

                     <div class="screen-box">
                        <div class="screen-header">
                            <strong>Smoking (MECC)</strong>
                        </div>
                        <div class="screen-content">
                             <div class="form-group checkbox-group">
                                <input type="checkbox" id="patient-smoker">
                                <label>Current Smoker?</label>
                            </div>
                            <div id="smoker-advice" style="display:none; margin-left:20px;">
                                <div class="form-group checkbox-group">
                                    <input type="checkbox" id="smoke-advice-given">
                                    <label>Brief Advice Given?</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card span-2">
                <h2 id="obs-title">Physiological Observations</h2>
                <div class="dashboard">
                    <div id="obs-form-container">
                        <p style="opacity:0.6;">Enter DOB to unlock relevant scoring.</p>
                    </div>
                    <div id="ews-display-container" style="display: none;">
                        <h3 style="margin-top:0;">Visual Chart</h3>
                        <div id="visual-ews-container"></div>
                    </div>
                </div>
            </div>
            
            <div id="paediatric-dosing-card" class="card" style="display: none; border: 2px solid var(--orange);">
                <h2>Paediatric Safety (Weight Based)</h2>
                <div class="form-group checkbox-group" style="background: rgba(237, 135, 45, 0.1); padding: 10px;">
                    <input type="checkbox" id="renal-impairment"><label style="color:var(--orange); font-weight:bold;">Renal Impairment / Dehydration</label>
                </div>
                <div id="paediatric-dosing-results"></div>
            </div>
            
            <div class="card span-2">
                <h2>Triage Decision & Plan</h2>
                <div class="dashboard">
                    <div>
                        <div id="summary-priority-display" class="summary-priority-Blue">AWAITING DATA</div>
                        <ul id="priority-reasons" style="font-size:0.9em; color:var(--secondary-color);"></ul>
                        
                        <div class="override-box">
                            <div class="form-group checkbox-group">
                                <input type="checkbox" id="override-toggle">
                                <label for="override-toggle"><strong>Clinical Override</strong></label>
                            </div>
                            <div id="override-controls" style="display:none; margin-top:10px;">
                                <select id="override-priority">
                                    <option value="">Select Priority</option>
                                    <option value="Red">Red (Immediate)</option>
                                    <option value="Orange">Orange (Very Urgent)</option>
                                    <option value="Yellow">Yellow (Urgent)</option>
                                    <option value="Green">Green (Standard)</option>
                                    <option value="Blue">Blue (Non-Urgent)</option>
                                </select>
                                <input type="text" id="override-rationale" placeholder="Reason for override (Mandatory)..." style="margin-top:5px;">
                            </div>
                        </div>
                    </div>
                    <div>
                        <h3>Clinical Protocol</h3>
                        <div id="actions-list-container">
                            <p style="opacity:0.6;">Select a presenting complaint.</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card full-width">
                <h2>Documentation</h2>
                <label>EPR Note</label>
                <textarea id="epr-note" rows="8" readonly></textarea>
                <button id="btn-copy-note" type="button" style="margin-top: 10px;">Copy to Clipboard</button>
            </div>
        </div>
        <footer>
            <p>V8.0 | Educational Use Only | Always adhere to local trust guidelines.</p>
        </footer>
    </div>
    
    <script src="protocols.js"></script>
    <script src="app.js"></script>
</body>
</html>
