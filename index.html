<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Triage Dashboard v4.2</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <div id="toast-container"></div>

    <div class="container">
        <header>
             <div id="logo-container">
                <img id="logo" src="https://iili.io/KGQOvkl.md.png" alt="WMEBEM Logo">
                <h1>Advanced Triage Dashboard</h1>
            </div>
            <div style="display:flex; align-items:center;">
                <div class="theme-switch-wrapper">
                    <label class="theme-switch" for="checkbox-theme">
                        <input type="checkbox" id="checkbox-theme" />
                        <div class="slider"></div>
                    </label>
                    <span style="font-size:0.8em; margin-left:5px;">Dark Mode</span>
                </div>
                <button id="btn-reset">Start New</button>
            </div>
        </header>

        <div class="dashboard">

            <div class="card">
                <h2>Patient Demographics</h2>
                 <div class="form-group checkbox-group">
                    <input type="checkbox" id="patient-referral"><label for="patient-referral">GP / Specialty Referral</label>
                </div>
                <div class="form-group"><label for="patient-id">Patient Name / ID</label><input type="text" id="patient-id" placeholder="e.g., John Doe"></div>
                
                <div class="form-group">
                    <label for="patient-dob">Date of Birth</label>
                    <input type="date" id="patient-dob">
                </div>
                <div class="form-group">
                    <label>Calculated Age: <span id="calculated-age-display" style="font-weight: normal; color: var(--secondary-color);">--</span></label>
                </div>

                <div class="form-group"><label for="patient-weight">Weight</label><div class="input-group"><input type="number" id="patient-weight" min="0"><span>kg</span></div></div>
                <div class="form-group"><label for="patient-sex">Sex</label><select id="patient-sex"><option value="">-- Select --</option><option value="Male">Male</option><option value="Female">Female</option><option value="Other">Other</option></select></div>
                <div class="form-group" id="other-sex-container" style="display: none;"><label for="other-sex-text">Please specify:</label><input type="text" id="other-sex-text"></div>
                
                <div class="form-group checkbox-group" id="pregnancy-container" style="display: none;">
                    <input type="checkbox" id="patient-pregnant"><label for="patient-pregnant">Pregnant or <6w Postpartum</label>
                </div>
            </div>
            
             <div class="card">
                <h2>Clinical History</h2>
                <div class="form-group">
                    <div class="label-with-checkbox">
                        <label for="allergies">Allergies</label>
                        <button class="quick-btn" onclick="setQuickText('allergies', 'NKDA')">NKDA</button>
                    </div>
                    <textarea id="allergies" rows="2" placeholder="e.g., Penicillin..."></textarea>
                </div>
                <div class="form-group">
                    <div class="label-with-checkbox">
                        <label for="pmh">Past Medical History</label>
                        <button class="quick-btn" onclick="setQuickText('pmh', 'Nil known')">Nil</button>
                    </div>
                    <textarea id="pmh" rows="3" placeholder="e.g., IHD, Asthma..."></textarea>
                </div>
                <div class="form-group">
                    <div class="label-with-checkbox">
                        <label for="meds">Prescribed Medications</label>
                        <button class="quick-btn" onclick="setQuickText('meds', 'Nil known')">Nil</button>
                    </div>
                    <textarea id="meds" rows="3" placeholder="e.g., Aspirin, Anticoagulants..."></textarea>
                </div>
            </div>

            <div class="card span-2">
                <h2>Presenting Complaint</h2>
                <div class="dashboard">
                    <div id="complaint-section">
                        <div class="form-group">
                            <label for="mts-flowchart-input">Primary Complaint (Searchable):</label>
                            <input list="flowcharts" id="mts-flowchart-input" placeholder="Type to search e.g. 'Chest'">
                            <datalist id="flowcharts"></datalist>
                        </div>
                        
                        <div class="form-group">
                            <label>Pain Score (0-10)</label>
                            <div class="pain-slider-container">
                                <span>0</span>
                                <input type="range" id="pain-score" min="0" max="10" value="0">
                                <span>10</span>
                                <span id="pain-score-val" class="pain-value">0</span>
                            </div>
                        </div>

                        <div class="form-group"><label for="complaint-info">History of Presenting Complaint:</label><textarea id="complaint-info" rows="4" placeholder="e.g., Took 16 paracetamol tablets 2 hours ago..."></textarea></div>
                    </div>
                    <div id="discriminator-section">
                        <label>Select Highest Priority Discriminator:</label>
                        <div id="discriminators-container" style="max-height: 250px; overflow-y: auto; padding-right: 10px;">
                            <p style="opacity:0.6;">Select a complaint first.</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card span-2">
                <h2 id="obs-title">Physiological Observations</h2>
                <div class="dashboard">
                    <div id="obs-form-container">
                        <p style="opacity:0.6;">Enter Date of Birth to unlock.</p>
                    </div>
                    <div id="ews-display-container" style="display: none;">
                         <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <h3 style="margin: 0;" id="ews-title">Total Score:</h3>
                            <span id="total-ews-score" style="font-size: 2.5em; font-weight: bold; color: var(--primary-color);">0</span>
                             <div id="meows-trigger-display" style="display:none;"></div>
                        </div>
                        <div id="visual-ews-container"></div>
                    </div>
                </div>
            </div>
            
             <div class="card span-2">
                <h2>Opportunistic Screening</h2>
                <div class="dashboard">
                     <div>
                        <h3>Smoking & Frailty</h3>
                        <div class="form-group"><label for="smoking-status">Smoking Status</label><select id="smoking-status"><option value="">-- Select --</option><option value="Current">Current Smoker</option><option value="Ex">Ex-Smoker</option><option value="Never">Never Smoked</option></select></div>
                        
                        <div id="frailty-scale-container" style="display: none;">
                            <div class="form-group">
                                <label for="frailty-scale">Clinical Frailty Scale (>=65y)</label>
                                <select id="frailty-scale"><option value="">-- Select --</option><option value="1">1 - Very Fit</option><option value="2">2 - Well</option><option value="3">3 - Managing Well</option><option value="4">4 - Vulnerable</option><option value="5">5 - Mildly Frail</option><option value="6">6 - Moderately Frail</option><option value="7">7 - Severely Frail</option><option value="8">8 - Very Severely Frail</option><option value="9">9 - Terminally Ill</option></select>
                            </div>
                        </div>
                        
                        <h3>Safeguarding</h3>
                        <div class="form-group"><label for="da-screen-asked">Asked about domestic abuse (alone)?</label><select id="da-screen-asked"><option value="">-- Select --</option><option value="Yes">Yes</option><option value="No">No</option></select></div>
                        <div class="form-group" id="da-screen-result-container" style="display:none;"><label for="da-screen-result">Does the patient report feeling unsafe?</label><select id="da-screen-result"><option value="">-- Select --</option><option value="Yes">Yes - Unsafe</option><option value="No">No - Safe</option></select></div>
                    </div>
                </div>
            </div>

            <div id="paediatric-dosing-card" class="card" style="display: none;">
                <h2>Paediatric Dosing Safety</h2>
                <div class="form-group checkbox-group" style="background: rgba(237, 135, 45, 0.1); padding: 10px; border-radius: 4px;">
                    <input type="checkbox" id="renal-impairment">
                    <label for="renal-impairment" style="color:var(--orange); font-weight:bold;">Dehydration / Renal Impairment (Avoid NSAIDs)</label>
                </div>
                <p>Calculations based on weight: <strong id="dosing-weight">N/A kg</strong>.</p>
                <div id="paediatric-dosing-results"></div>
            </div>
            
            <div class="card">
                <h2>Live Alerts</h2>
                <ul id="alerts-list"></ul>
            </div>
            
            <div class="card">
                <h2>Action Plan</h2>
                <div id="summary-priority-display">Awaiting Triage</div>
                 <div class="form-group checkbox-group" style="margin-top: 15px; border-bottom: 1px solid var(--border-color); padding-bottom: 10px;">
                    <input type="checkbox" id="tick-all-actions"><label for="tick-all-actions">Tick All</label>
                </div>
                <ul id="actions-list"><li>Awaiting triage completion.</li></ul>
            </div>
            
            <div class="card full-width">
                <h2>Notes & Handover</h2>
                <div class="dashboard">
                    <div>
                        <label for="epr-note">Triage Note (EPR)</label>
                        <textarea id="epr-note" rows="10" readonly></textarea>
                        <button id="btn-copy-note" type="button" style="margin-top: 10px;">Copy formatted</button>
                    </div>
                    <div>
                        <label for="sbar-note">SBAR Handover</label>
                        <textarea id="sbar-note" rows="10" readonly></textarea>
                        <button id="btn-copy-sbar" type="button" style="margin-top: 10px;">Copy formatted</button>
                    </div>
                </div>
            </div>
        </div>
        <footer>
            <p><strong>Disclaimer:</strong> This application is for educational and demonstration purposes only. V4.2</p>
        </footer>
    </div>
    
    <script src="protocols.js"></script>
    <script src="app.js"></script>
</body>
</html>
